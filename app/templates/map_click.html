<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Map â€¢ Sea Temperature</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body {
            margin: 0;
            font-family: system-ui, -apple-system;
        }

        #map {
            height: 100vh;
            width: 100vw;
        }

        .panel {
            position: absolute;
            top: 16px;
            left: 16px;
            z-index: 1000;
            background: white;
            padding: 14px 14px;
            border-radius: 14px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, .15);
            min-width: 260px;
        }

        .title {
            font-size: 16px;
            font-weight: 800;
            margin-bottom: 6px;
        }

        .sub {
            font-size: 12px;
            color: #64748b;
        }

        .big {
            font-size: 30px;
            font-weight: 900;
            margin: 6px 0;
        }

        .btn {
            display: inline-block;
            margin-top: 10px;
            padding: 10px 12px;
            border-radius: 12px;
            background: #0ea5e9;
            color: white;
            text-decoration: none;
            font-weight: 800;
        }
    </style>
</head>

<body>
    <div id="map"></div>

    <div class="panel">
        <div class="title">ðŸŒŠ Click the ocean</div>
        <div class="sub">Weâ€™ll estimate sea temperature within 3km.</div>
        <div id="info" style="margin-top:10px;" class="sub">Tip: first click in a new area may take a few seconds (we
            cache it).</div>
        <a class="btn" href="/">Home</a>
    </div>

    <script>
        const map = L.map('map').setView([36, 18], 5);
        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 10 }).addTo(map);

        let marker = null;

        function comfortLabel(t) {
            if (t < 17) return "ðŸ¥¶ Cold";
            if (t < 20) return "ðŸ˜¬ Brave";
            if (t < 23) return "ðŸ™‚ Nice";
            if (t < 26) return "ðŸ˜ Perfect";
            return "ðŸ”¥ Very warm";
        }

        async function onMapClick(e) {
            const lat = e.latlng.lat;
            const lon = e.latlng.lng;

            if (marker) map.removeLayer(marker);
            marker = L.circleMarker([lat, lon], { radius: 7, weight: 2, color: "#111", fillColor: "#fff", fillOpacity: 1 }).addTo(map);

            document.getElementById("info").innerHTML = "Loadingâ€¦";

            const res = await fetch(`/api/point?lat=${lat}&lon=${lon}&radius_km=3`);
            const data = await res.json();

            if (data.status !== "ok") {
                document.getElementById("info").innerHTML = `No data here (likely land/nearshore gap).`;
                return;
            }

            document.getElementById("info").innerHTML = `
      <div class="sub">Updated ${data.date} â€¢ radius ${data.radius_km} km â€¢ cells ${data.cells_used}</div>
      <div class="big">${data.mean_c.toFixed(1)} Â°C</div>
      <div class="sub">${comfortLabel(data.mean_c)}</div>
    `;
        }

        map.on("click", onMapClick);
    </script>
</body>

</html>