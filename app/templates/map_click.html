<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Sea Temperature â€¢ Map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            background: #0b1c2d;
            color: white;
        }

        #map {
            height: 100vh;
            width: 100vw;
        }

        .panel {
            position: absolute;
            top: 24px;
            left: 24px;
            z-index: 1000;

            background: rgba(255, 255, 255, 0.98);
            padding: 26px;
            border-radius: 22px;
            box-shadow: 0 18px 45px rgba(0, 0, 0, 0.12);

            min-width: 340px;
            color: #1e293b;
        }

        .title {
            font-size: 20px;
            font-weight: 800;
            margin-bottom: 6px;
        }

        .sub {
            font-size: 14px;
            color: #64748b;
        }

        .big {
            font-size: 48px;
            font-weight: 900;
            margin: 16px 0 6px;
            letter-spacing: -1px;

        }

        .badge {
            display: inline-block;
            padding: 6px 10px;
            border-radius: 14px;
            font-size: 12px;
            font-weight: 700;
            margin-top: 6px;
        }

        .btn {
            display: inline-block;
            margin-top: 18px;
            padding: 12px 16px;
            border-radius: 16px;
            background: #0ea5e9;
            color: white;
            text-decoration: none;
            font-weight: 700;
            transition: all 0.2s ease;
        }

        .btn:hover {
            background: #0284c7;
        }

        .spinner {
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255, 255, 255, 0.2);
            border-top: 3px solid #4FC3F7;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-top: 12px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .topbar {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
            font-weight: 700;
        }

        .topbar a {
            color: white;
            padding: 8px 12px;
            border-radius: 12px;
            text-decoration: none;
            margin-left: 10px;
            color: #0f172a;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 1);
            opacity: 0.7;
        }

        .topbar a:hover {
            background: #f1f5f9;
        }
    </style>
</head>

<body>

    <div id="map"></div>

    <div class="panel">
        <div class="title">ðŸŒŠ Sea Temperature Explorer</div>
        <div class="sub">Click anywhere on the ocean to check if it's swim-ready.</div>

        <div id="info" style="margin-top:14px;" class="sub">
            Planning a beach day? Letâ€™s find the perfect water temperature.
        </div>

        <a class="btn" href="/">Home</a>
    </div>

    <div class="topbar">
        <a href="/">Home</a>
        <a href="/about">About</a>
    </div>

    <script>
        const map = L.map('map').setView([36, 18], 5);

        L.tileLayer(
            'https://tile.openstreetmap.org/{z}/{x}/{y}.png',
            { maxZoom: 10 }
        ).addTo(map);

        let marker = null;

        function comfortLabel(t) {
            if (t < 17) return ["Cold", "#2563eb"];
            if (t < 20) return ["Brave", "#0ea5e9"];
            if (t < 23) return ["Nice", "#22c55e"];
            if (t < 26) return ["Perfect", "#f59e0b"];
            return ["Very warm", "#ef4444"];
        }

        async function onMapClick(e) {
            const ll = map.wrapLatLng(e.latlng);
            const lat = ll.lat;
            const lon = ll.lng;


            if (marker) map.removeLayer(marker);

            marker = L.circleMarker([lat, lon], {
                radius: 8,
                weight: 2,
                color: "#fff",
                fillColor: "#4FC3F7",
                fillOpacity: 1
            }).addTo(map);

            document.getElementById("info").innerHTML =
                `<div class="spinner"></div>`;

            const res = await fetch(`/api/point?lat=${lat}&lon=${lon}&radius_km=3`);
            const data = await res.json();

            if (data.status !== "ok") {
                document.getElementById("info").innerHTML =
                    `<div class="sub">No ocean data here.</div>`;
                return;
            }

            const [label, color] = comfortLabel(data.mean_c);

            document.getElementById("info").innerHTML = `
                <div class="sub">Updated ${data.date}</div>
                <div class="big">${data.mean_c.toFixed(1)} Â°C</div>
                <div class="badge" style="background:${color}">${label}</div>
                <div class="sub" style="margin-top:8px;">
                    Radius ${data.radius_km} km â€¢ ${data.cells_used} cells
                </div>
            `;
        }

        map.on("click", onMapClick);
    </script>

</body>

</html>